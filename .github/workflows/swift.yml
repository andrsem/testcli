# This workflow will build a Swift project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: Swift

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  tests:
    name: Test
    uses: swiftlang/github-workflows/.github/workflows/swift_package_test.yml@main
    with:
      linux_os_versions: '["amazonlinux2", "bookworm", "noble", "jammy", "rhel-ubi9"]'
      linux_swift_versions: '["6.2"]'
      linux_pre_build_command: |
        if command -v apt-get >/dev/null 2>&1 ; then # bookworm, noble, jammy
          apt-get update -y

          # Test dependencies
          apt-get install -y procps
        elif command -v dnf >/dev/null 2>&1 ; then # rhel-ubi9
          dnf update -y

          # Test dependencies
          dnf install -y procps
        elif command -v yum >/dev/null 2>&1 ; then # amazonlinux2
          yum update -y

          # Test dependencies
          yum install -y procps
        fi
      linux_build_command: 'swift test && swift test -c release'
      windows_swift_versions: '["6.2"]'
      windows_build_command: |
        Invoke-Program swift test
        Invoke-Program swift test -c release
        Invoke-Program swift test --disable-default-traits
      enable_macos_checks: true
      macos_xcode_versions: '["26.0"]'
      macos_build_command: 'xcrun swift test && xcrun swift test -c release'
      enable_linux_static_sdk_build: true
      linux_static_sdk_versions: '["6.2"]'
      linux_static_sdk_build_command: |
        for triple in aarch64-swift-linux-musl x86_64-swift-linux-musl ; do
          swift build --swift-sdk "\$triple"
        done
        # empty line to ignore the --swift-sdk given by swiftlang/github-workflows/.github/workflows/scripts/install-and-build-with-sdk.sh \
